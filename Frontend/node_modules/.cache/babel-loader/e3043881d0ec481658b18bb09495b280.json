{"ast":null,"code":"var _jsxFileName = \"/Users/ajay/Desktop/Cmp202 Project/team-project-tingting/Frontend/src/components/Checkout/Checkout.js\",\n    _s = $RefreshSig$();\n\nimport React from \"react\";\nimport { connect } from \"react-redux\";\nimport { Link, useHistory } from \"react-router-dom\";\nimport axios from \"axios\";\nimport { bookFlight, clearBooking } from \"../actions\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction Checkout(src) {\n  return new Promise(resolve => {\n    const script = document.createElement(\"script\");\n    script.src = src;\n\n    script.onload = () => {\n      resolve(true);\n    };\n\n    script.onerror = () => {\n      resolve(false);\n    };\n\n    document.body.appendChild(script);\n  });\n}\n\n_c = Checkout;\n\nfunction Payments(_ref) {\n  _s();\n\n  let {\n    flight,\n    user,\n    userDetails,\n    bookFlight,\n    clearBooking\n  } = _ref;\n  const fare = flight.fare;\n  let history = useHistory();\n  const api = axios.create({\n    baseURL: `http://localhost:9100/bookings`\n  });\n\n  function getEmail() {\n    if (user.method === \"local\") {\n      return user.local.email;\n    } else if (user.method === \"facebook\") {\n      return user.facebook.email;\n    } else if (user.method === \"google\") {\n      return user.google.email;\n    }\n  }\n\n  async function displayRazorpay() {\n    const res = await loadScript(\"https://checkout.razorpay.com/v1/checkout.js\");\n\n    if (!res) {\n      alert(\"Razorpay SDK failed to load. Are you online?\");\n      return;\n    }\n\n    console.log(fare);\n    const data = await api.post(\"/razorpay\", {\n      fare\n    }); //   .then((t) => t.json());\n\n    console.log(data.data.amount);\n    const options = {\n      key: process.env.KEY_ID,\n      currency: data.data.currency,\n      amount: data.data.amount.toString(),\n      order_id: data.data.id,\n      name: \"Flight Booking\",\n      description: \"Complete payment to book the flight\",\n      //   image: \"http://localhost:1337/logo.svg\",\n      handler: async function (response) {\n        // alert(response.razorpay_payment_id);\n        // alert(response.razorpay_order_id);\n        // alert(response.razorpay_signature);\n        console.log(userDetails._id);\n        await clearBooking();\n        await bookFlight(userDetails, flight);\n        history.push(\"/successpage\");\n      },\n      prefill: {\n        email: getEmail()\n      }\n    };\n    const paymentObject = new window.Razorpay(options);\n    paymentObject.open();\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(Breadcrumb, {\n      children: [/*#__PURE__*/_jsxDEV(Breadcrumb.Item, {\n        children: /*#__PURE__*/_jsxDEV(Link, {\n          to: \"/\",\n          children: \"Search Flights\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 81,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 80,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Breadcrumb.Item, {\n        children: /*#__PURE__*/_jsxDEV(Link, {\n          to: \"/book\",\n          children: \"Traveller Details\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 84,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 83,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Breadcrumb.Item, {\n        active: true,\n        children: \"Payment\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 86,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 79,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Jumbotron, {\n      children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n        children: [\"Pay \", fare]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 89,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: /*#__PURE__*/_jsxDEV(Button, {\n          onClick: displayRazorpay,\n          variant: \"primary\",\n          children: \"Pay now\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 91,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 90,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 78,\n    columnNumber: 5\n  }, this);\n}\n\n_s(Payments, \"9cZfZ04734qoCGIctmKX7+sX6eU=\", false, function () {\n  return [useHistory];\n});\n\n_c2 = Payments;\n\nfunction mapStateToProps(state) {\n  return {\n    errorMessage: state.auth.errorMessage,\n    flight: state.flight.flight,\n    user: state.auth.user,\n    userDetails: state.flight.userDetails\n  };\n}\n\nfunction mapDispatchToProps(dispatch) {\n  return {\n    bookFlight: (userDetails, flight) => dispatch(bookFlight(userDetails, flight)),\n    clearBooking: () => dispatch(clearBooking())\n  };\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Checkout);\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"Checkout\");\n$RefreshReg$(_c2, \"Payments\");","map":{"version":3,"sources":["/Users/ajay/Desktop/Cmp202 Project/team-project-tingting/Frontend/src/components/Checkout/Checkout.js"],"names":["React","connect","Link","useHistory","axios","bookFlight","clearBooking","Checkout","src","Promise","resolve","script","document","createElement","onload","onerror","body","appendChild","Payments","flight","user","userDetails","fare","history","api","create","baseURL","getEmail","method","local","email","facebook","google","displayRazorpay","res","loadScript","alert","console","log","data","post","amount","options","key","process","env","KEY_ID","currency","toString","order_id","id","name","description","handler","response","_id","push","prefill","paymentObject","window","Razorpay","open","mapStateToProps","state","errorMessage","auth","mapDispatchToProps","dispatch"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport { connect } from \"react-redux\";\nimport { Link, useHistory } from \"react-router-dom\";\nimport axios from \"axios\";\n\nimport { bookFlight, clearBooking } from \"../actions\";\n\nfunction Checkout(src) {\n  return new Promise((resolve) => {\n    const script = document.createElement(\"script\");\n    script.src = src;\n    script.onload = () => {\n      resolve(true);\n    };\n    script.onerror = () => {\n      resolve(false);\n    };\n    document.body.appendChild(script);\n  });\n}\n\nfunction Payments({ flight, user, userDetails, bookFlight, clearBooking }) {\n  const fare = flight.fare;\n  let history = useHistory();\n\n  const api = axios.create({\n    baseURL: `http://localhost:9100/bookings`,\n  });\n  function getEmail() {\n    if (user.method === \"local\") {\n      return user.local.email;\n    } else if (user.method === \"facebook\") {\n      return user.facebook.email;\n    } else if (user.method === \"google\") {\n      return user.google.email;\n    }\n  }\n  async function displayRazorpay() {\n    const res = await loadScript(\n      \"https://checkout.razorpay.com/v1/checkout.js\"\n    );\n\n    if (!res) {\n      alert(\"Razorpay SDK failed to load. Are you online?\");\n      return;\n    }\n    console.log(fare);\n    const data = await api.post(\"/razorpay\", { fare });\n    //   .then((t) => t.json());\n\n    console.log(data.data.amount);\n\n    const options = {\n      key: process.env.KEY_ID,\n      currency: data.data.currency,\n      amount: data.data.amount.toString(),\n      order_id: data.data.id,\n      name: \"Flight Booking\",\n      description: \"Complete payment to book the flight\",\n      //   image: \"http://localhost:1337/logo.svg\",\n      handler: async function (response) {\n        // alert(response.razorpay_payment_id);\n        // alert(response.razorpay_order_id);\n        // alert(response.razorpay_signature);\n        console.log(userDetails._id);\n        await clearBooking();\n        await bookFlight(userDetails, flight);\n        history.push(\"/successpage\");\n      },\n      prefill: {\n        email: getEmail(),\n      },\n    };\n    const paymentObject = new window.Razorpay(options);\n    paymentObject.open();\n  }\n  return (\n    <div>\n      <Breadcrumb>\n        <Breadcrumb.Item>\n          <Link to=\"/\">Search Flights</Link>\n        </Breadcrumb.Item>\n        <Breadcrumb.Item>\n          <Link to=\"/book\">Traveller Details</Link>\n        </Breadcrumb.Item>\n        <Breadcrumb.Item active>Payment</Breadcrumb.Item>\n      </Breadcrumb>\n      <Jumbotron>\n        <h4>Pay {fare}</h4>\n        <p>\n          <Button onClick={displayRazorpay} variant=\"primary\">\n            Pay now\n          </Button>\n        </p>\n      </Jumbotron>\n    </div>\n  );\n}\n\nfunction mapStateToProps(state) {\n  return {\n    errorMessage: state.auth.errorMessage,\n    flight: state.flight.flight,\n    user: state.auth.user,\n    userDetails: state.flight.userDetails,\n  };\n}\n\nfunction mapDispatchToProps(dispatch) {\n  return {\n    bookFlight: (userDetails, flight) =>\n      dispatch(bookFlight(userDetails, flight)),\n    clearBooking: () => dispatch(clearBooking()),\n  };\n}\nexport default connect(mapStateToProps, mapDispatchToProps)(Checkout);\n"]},"metadata":{},"sourceType":"module"}